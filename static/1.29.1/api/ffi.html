
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>FFI Module</title>
    <meta name="description" content="Janet is a functional and imperative programming language. It runs on Windows, Linux, macOS, FreeBSD and *nix.">
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="../css/docpage.css" type="text/css" media="screen" charset="utf-8">
    <link rel="shortcut icon" href="../assets/favicon.ico">

    <!-- Open Graph -->
    <meta property="og:description" content="Janet is a functional and imperative programming language. It runs on Windows, Linux, macOS, FreeBSD and *nix." />
    <meta property="og:title" content="FFI Module" />
    <meta property="og:type" content="website" />
  </head>
  <body>

    <div id="toc-toggle" class="open">
      <div class="bar topbar"></div>
      <div class="bar"></div>
      <div class="bar botbar"></div>
    </div>
    <iframe class="search-bar" src="https://duckduckgo.com/search.html?site=janet-lang.org&prefill=Search janet-lang.org" frameborder="0"></iframe>
    <script charset="utf-8">
      function toggleToc() {
        var toggler = document.getElementById('toc-toggle');
        var wrapper = document.querySelector('.toc');
        wrapper.classList.toggle('toc-hidden');
        toggler.classList.toggle('open');
        if (window.localStorage) {
          window.localStorage.setItem('show-toc', toggler.classList.contains('open'));
        }
      }
      function addTocToggle() {
        var el = document.getElementById('toc-toggle');
        if (!window.localStorage || window.localStorage.getItem('show-toc') === 'true') {
          toggleToc()
        }
        el.addEventListener('click', toggleToc);
      }
      window.addEventListener('DOMContentLoaded', addTocToggle);
    </script>

    

    <div class="twocol">
      <div class="toc show-toc">
        <ul>
          <li><span><a href="../index.html">Home</a></span></li><li class="caret"><span><a href="../docs/index.html">Documentation</a></span><ul><li><span><a href="../docs/syntax.html">Syntax and the Parser</a></span></li><li><span><a href="../docs/specials.html">Special Forms</a></span></li><li><span><a href="../docs/numbers.html">Numbers and Arithmetic</a></span></li><li><span><a href="../docs/comparison.html">Comparison Operators</a></span></li><li><span><a href="../docs/bindings.html">Bindings (def and var)</a></span></li><li><span><a href="../docs/flow.html">Flow</a></span></li><li><span><a href="../docs/functions.html">Functions</a></span></li><li><span><a href="../docs/strings.html">Strings, Keywords, and Symbols</a></span></li><li><span><a href="../docs/loop.html">Looping</a></span></li><li><span><a href="../docs/macros.html">Macros</a></span></li><li class="caret"><span><a href="../docs/data_structures/index.html">Data Structures</a></span><ul><li><span><a href="../docs/data_structures/arrays.html">Arrays</a></span></li><li><span><a href="../docs/data_structures/buffers.html">Buffers</a></span></li><li><span><a href="../docs/data_structures/tables.html">Tables</a></span></li><li><span><a href="../docs/data_structures/structs.html">Structs</a></span></li><li><span><a href="../docs/data_structures/tuples.html">Tuples</a></span></li></ul></li><li><span><a href="../docs/destructuring.html">Destructuring</a></span></li><li class="caret"><span><a href="../docs/fibers/index.html">Fibers</a></span><ul><li><span><a href="../docs/fibers/dynamic_bindings.html">Dynamic Bindings</a></span></li><li><span><a href="../docs/fibers/error_handling.html">Errors</a></span></li></ul></li><li><span><a href="../docs/modules.html">Modules</a></span></li><li><span><a href="../docs/object_oriented.html">Object-Oriented Programming</a></span></li><li><span><a href="../docs/peg.html">Parsing Expression Grammars</a></span></li><li><span><a href="../docs/prototypes.html">Prototypes</a></span></li><li><span><a href="../docs/abstract_machine.html">The Janet Abstract Machine</a></span></li><li><span><a href="../docs/event_loop.html">The Event Loop</a></span></li><li><span><a href="../docs/threads.html">Multithreading</a></span></li><li><span><a href="../docs/networking.html">Networking</a></span></li><li><span><a href="../docs/documentation.html">Documentation</a></span></li><li><span><a href="../docs/jpm.html">jpm</a></span></li><li><span><a href="../docs/linting.html">Linting</a></span></li><li><span><a href="../docs/ffi.html">Foreign Function Interface</a></span></li></ul></li><li class="caret"><span><a href="index.html">API</a></span><ul><li><span><a href="array.html">array</a></span></li><li><span><a href="buffer.html">buffer</a></span></li><li><span><a href="debug.html">debug</a></span></li><li><span><a href="ev.html">ev</a></span></li><li><span class="selected"><a href="ffi.html">ffi</a></span></li><li><span><a href="fiber.html">fiber</a></span></li><li><span><a href="file.html">file</a></span></li><li><span><a href="int.html">int</a></span></li><li class="caret"><span><a href="jpm/index.html">jpm</a></span><ul><li><span><a href="jpm/rules.html">rules</a></span></li><li><span><a href="jpm/cc.html">cc</a></span></li><li><span><a href="jpm/cgen.html">cgen</a></span></li><li><span><a href="jpm/cli.html">cli</a></span></li><li><span><a href="jpm/commands.html">commands</a></span></li><li><span><a href="jpm/config.html">config</a></span></li><li><span><a href="jpm/make-config.html">make-config</a></span></li><li><span><a href="jpm/dagbuild.html">dagbuild</a></span></li><li><span><a href="jpm/pm.html">pm</a></span></li><li><span><a href="jpm/scaffold.html">scaffold</a></span></li><li><span><a href="jpm/shutil.html">shutil</a></span></li></ul></li><li><span><a href="math.html">math</a></span></li><li><span><a href="module.html">module</a></span></li><li><span><a href="net.html">net</a></span></li><li><span><a href="os.html">os</a></span></li><li><span><a href="peg.html">peg</a></span></li><li><span><a href="parser.html">parser</a></span></li><li class="caret"><span><a href="spork/index.html">spork</a></span><ul><li><span><a href="spork/argparse.html">argparse</a></span></li><li><span><a href="spork/base64.html">base64</a></span></li><li><span><a href="spork/crc.html">crc</a></span></li><li><span><a href="spork/cron.html">cron</a></span></li><li><span><a href="spork/ev-utils.html">ev-utils</a></span></li><li><span><a href="spork/fmt.html">fmt</a></span></li><li><span><a href="spork/generators.html">generators</a></span></li><li><span><a href="spork/getline.html">getline</a></span></li><li><span><a href="spork/htmlgen.html">htmlgen</a></span></li><li><span><a href="spork/http.html">http</a></span></li><li><span><a href="spork/httpf.html">httpf</a></span></li><li><span><a href="spork/json.html">json</a></span></li><li><span><a href="spork/math.html">math</a></span></li><li><span><a href="spork/misc.html">misc</a></span></li><li><span><a href="spork/netrepl.html">netrepl</a></span></li><li><span><a href="spork/path.html">path</a></span></li><li><span><a href="spork/rawterm.html">rawterm</a></span></li><li><span><a href="spork/regex.html">regex</a></span></li><li><span><a href="spork/rpc.html">rpc</a></span></li><li><span><a href="spork/schema.html">schema</a></span></li><li><span><a href="spork/sh.html">sh</a></span></li><li><span><a href="spork/msg.html">msg</a></span></li><li><span><a href="spork/test.html">test</a></span></li><li><span><a href="spork/tarray.html">tarray</a></span></li><li><span><a href="spork/zip.html">zip</a></span></li></ul></li><li><span><a href="string.html">string</a></span></li><li><span><a href="table.html">table</a></span></li><li><span><a href="misc.html">misc</a></span></li><li><span><a href="tuple.html">tuple</a></span></li></ul></li><li class="caret"><span><a href="../capi/index.html">C API</a></span><ul><li><span><a href="../capi/wrapping.html">Wrapping Types</a></span></li><li><span><a href="../capi/embedding.html">Embedding</a></span></li><li><span><a href="../capi/configuration.html">Configuration</a></span></li><li><span><a href="../capi/array.html">Array C API</a></span></li><li><span><a href="../capi/buffer.html">Buffer C API</a></span></li><li><span><a href="../capi/table.html">Table C API</a></span></li><li><span><a href="../capi/fiber.html">Fiber C API</a></span></li><li><span><a href="../capi/memory-model.html">Memory Model</a></span></li><li><span><a href="../capi/writing-c-functions.html">Writing C Functions</a></span></li></ul></li>
        </ul>
      </div>
      <div class="content-wrapper main-content">
        <h4 class="subtitle">Janet 1.29.1-3a4d56a Documentation<br>(Other Versions:
          
          <a href="../../1.28.0/api/ffi.html">1.28.0</a>
          
          <a href="../../1.27.0/api/ffi.html">1.27.0</a>
          
          <a href="../../1.26.0/api/ffi.html">1.26.0</a>
          
          <a href="../../1.25.1/api/ffi.html">1.25.1</a>
          
          <a href="../../1.24.0/api/ffi.html">1.24.0</a>
          
          <a href="../../1.23.0/api/ffi.html">1.23.0</a>
          
          <a href="../../1.22.0/api/ffi.html">1.22.0</a>
          
          <a href="../../1.21.0/api/ffi.html">1.21.0</a>
          
          <a href="../../1.20.0/api/ffi.html">1.20.0</a>
          
          <a href="../../1.19.0/api/ffi.html">1.19.0</a>
          
          <a href="../../1.18.1/api/ffi.html">1.18.1</a>
          
          <a href="../../1.17.1/api/ffi.html">1.17.1</a>
          
          <a href="../../1.16.1/api/ffi.html">1.16.1</a>
          
          <a href="../../1.15.0/api/ffi.html">1.15.0</a>
          
          <a href="../../1.13.1/api/ffi.html">1.13.1</a>
          
          <a href="../../1.12.2/api/ffi.html">1.12.2</a>
          
          <a href="../../1.11.1/api/ffi.html">1.11.1</a>
          
          <a href="../../1.10.1/api/ffi.html">1.10.1</a>
          
          <a href="../../1.9.1/api/ffi.html">1.9.1</a>
          
          <a href="../../1.8.1/api/ffi.html">1.8.1</a>
          
          <a href="../../1.7.0/api/ffi.html">1.7.0</a>
          
          <a href="../../1.6.0/api/ffi.html">1.6.0</a>
          
          <a href="../../1.5.1/api/ffi.html">1.5.1</a>
          
          <a href="../../1.5.0/api/ffi.html">1.5.0</a>
          
          <a href="../../1.4.0/api/ffi.html">1.4.0</a>
          
          <a href="../../1.3.1/api/ffi.html">1.3.1</a>
          )</h4>
        <h1 class="subtitle">FFI Module</h1>
        <div class="prevnext-bar">
          <span class="prev"><a href="ev.html"><span class="prevnext-text">Event Module</span></a></span>

          <span class="next"><a href="fiber.html"><span class="prevnext-text">Fiber Module</span></a></span>
        </div>
        

<p>Janet's Foreign Function Interface module is used to interface with native code in
a way that does not require compiling native "glue" code. The tradeoff is the FFI module
is "unsafe" - there is no guarantee or even much protection from crashing your program
or triggering nonsensical behavior. This departs from Janet's usual memory safe programming
model.
</p>
<h2 id="Index-3">Index
</h2>
<p><a href="#ffi/align">ffi/align</a> <a href="#ffi/call">ffi/call</a> <a href="#ffi/calling-conventions">ffi/calling-conventions</a> <a href="#ffi/close">ffi/close</a> <a href="#ffi/context">ffi/context</a> <a href="#ffi/defbind">ffi/defbind</a> <a href="#ffi/free">ffi/free</a> <a href="#ffi/jitfn">ffi/jitfn</a> <a href="#ffi/lookup">ffi/lookup</a> <a href="#ffi/malloc">ffi/malloc</a> <a href="#ffi/native">ffi/native</a> <a href="#ffi/pointer-buffer">ffi/pointer-buffer</a> <a href="#ffi/read">ffi/read</a> <a href="#ffi/signature">ffi/signature</a> <a href="#ffi/size">ffi/size</a> <a href="#ffi/struct">ffi/struct</a> <a href="#ffi/trampoline">ffi/trampoline</a> <a href="#ffi/write">ffi/write</a> </p><hr><div class="binding"><span id="ffi/align" class="binding-sym">ffi/align</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L469">source</a></span> <pre class="binding-text">(ffi/align type)

Get the align of an ffi type in bytes.</pre><a href="https://janetdocs.com/ffi/align">Community Examples</a></div><hr><div class="binding"><span id="ffi/call" class="binding-sym">ffi/call</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L1358">source</a></span> <pre class="binding-text">(ffi/call pointer signature &amp; args)

Call a raw pointer as a function pointer. The function signature specifies how Janet values in `args` are converted to native machine types.</pre><a href="https://janetdocs.com/ffi/call">Community Examples</a></div><hr><div class="binding"><span id="ffi/calling-conventions" class="binding-sym">ffi/calling-conventions</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L1539">source</a></span> <pre class="binding-text">(ffi/calling-conventions)

Get an array of all supported calling conventions on the current arhcitecture. Some architectures may have some FFI functionality (ffi/malloc, ffi/free, ffi/read, ffi/write, etc.) but not support any calling conventions. This function can be used to get all supported calling conventions that can be used on this architecture. All architectures support the :none calling convention which is a placeholder that cannot be used at runtime.</pre><a href="https://janetdocs.com/ffi/calling-conventions">Community Examples</a></div><hr><div class="binding"><span id="ffi/close" class="binding-sym">ffi/close</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L1484">source</a></span> <pre class="binding-text">(ffi/close native)

Free a native object. Dereferencing pointers to symbols in the object will have undefined behavior after freeing.</pre><a href="https://janetdocs.com/ffi/close">Community Examples</a></div><hr><div class="binding"><span id="ffi/context" class="binding-sym">ffi/context</span> <span class="binding-type">function</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/boot/boot.janet#L3756">source</a></span> <pre class="binding-text">(ffi/context &amp;opt native-path &amp;named map-symbols lazy)

Set the path of the dynamic library to implictly bind, as well as other global state for ease of creating native bindings.</pre><a href="https://janetdocs.com/ffi/context">Community Examples</a></div><hr><div class="binding"><span id="ffi/defbind" class="binding-sym">ffi/defbind</span> <span class="binding-type">macro</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/boot/boot.janet#L3770">source</a></span> <pre class="binding-text">(ffi/defbind name ret-type &amp; body)

Generate bindings for native functions in a convenient manner.</pre><a href="https://janetdocs.com/ffi/defbind">Community Examples</a></div><hr><div class="binding"><span id="ffi/free" class="binding-sym">ffi/free</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L1507">source</a></span> <pre class="binding-text">(ffi/free pointer)

Free memory allocated with `ffi/malloc`. Returns nil.</pre><a href="https://janetdocs.com/ffi/free">Community Examples</a></div><hr><div class="binding"><span id="ffi/jitfn" class="binding-sym">ffi/jitfn</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L1305">source</a></span> <pre class="binding-text">(ffi/jitfn bytes)

Create an abstract type that can be used as the pointer argument to `ffi/call`. The content of `bytes` is architecture specific machine code that will be copied into executable memory.</pre><a href="https://janetdocs.com/ffi/jitfn">Community Examples</a></div><hr><div class="binding"><span id="ffi/lookup" class="binding-sym">ffi/lookup</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L1470">source</a></span> <pre class="binding-text">(ffi/lookup native symbol-name)

Lookup a symbol from a native object. All symbol lookups will return a raw pointer if the symbol is found, else nil.</pre><a href="https://janetdocs.com/ffi/lookup">Community Examples</a></div><hr><div class="binding"><span id="ffi/malloc" class="binding-sym">ffi/malloc</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L1497">source</a></span> <pre class="binding-text">(ffi/malloc size)

Allocates memory directly using the janet memory allocator. Memory allocated in this way must be freed manually! Returns a raw pointer, or nil if size = 0.</pre><a href="https://janetdocs.com/ffi/malloc">Community Examples</a></div><hr><div class="binding"><span id="ffi/native" class="binding-sym">ffi/native</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L1454">source</a></span> <pre class="binding-text">(ffi/native &amp;opt path)

Load a shared object or dll from the given path, and do not extract or run any code from it. This is different than `native`, which will run initialization code to get a module table. If `path` is nil, opens the current running binary. Returns a `core/native`.</pre><a href="https://janetdocs.com/ffi/native">Community Examples</a></div><hr><div class="binding"><span id="ffi/pointer-buffer" class="binding-sym">ffi/pointer-buffer</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L1522">source</a></span> <pre class="binding-text">(ffi/pointer-buffer pointer capacity &amp;opt count offset)

Create a buffer from a pointer. The underlying memory of the buffer will not be reallocated or freed by the garbage collector, allowing unmanaged, mutable memory to be manipulated with buffer functions. Attempts to resize or extend the buffer beyond its initial capacity will raise an error. As with many FFI functions, this is memory unsafe and can potentially allow out of bounds memory access. Returns a new buffer.</pre><a href="https://janetdocs.com/ffi/pointer-buffer">Community Examples</a></div><hr><div class="binding"><span id="ffi/read" class="binding-sym">ffi/read</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L1407">source</a></span> <pre class="binding-text">(ffi/read ffi-type bytes &amp;opt offset)

Parse a native struct out of a buffer and convert it to normal Janet data structures. This function is the inverse of `ffi/write`. `bytes` can also be a raw pointer, although this is unsafe.</pre><a href="https://janetdocs.com/ffi/read">Community Examples</a></div><hr><div class="binding"><span id="ffi/signature" class="binding-sym">ffi/signature</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L769">source</a></span> <pre class="binding-text">(ffi/signature calling-convention ret-type &amp; arg-types)

Create a function signature object that can be used to make calls with raw function pointers.</pre><a href="https://janetdocs.com/ffi/signature">Community Examples</a></div><hr><div class="binding"><span id="ffi/size" class="binding-sym">ffi/size</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L461">source</a></span> <pre class="binding-text">(ffi/size type)

Get the size of an ffi type in bytes.</pre><a href="https://janetdocs.com/ffi/size">Community Examples</a></div><hr><div class="binding"><span id="ffi/struct" class="binding-sym">ffi/struct</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L454">source</a></span> <pre class="binding-text">(ffi/struct &amp; types)

Create a struct type definition that can be used to pass structs into native functions. </pre><a href="https://janetdocs.com/ffi/struct">Community Examples</a></div><hr><div class="binding"><span id="ffi/trampoline" class="binding-sym">ffi/trampoline</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L1430">source</a></span> <pre class="binding-text">(ffi/trampoline cc)

Get a native function pointer that can be used as a callback and passed to C libraries. This callback trampoline has the signature `void trampoline(void \*ctx, void \*userdata)` in the given calling convention. This is the only function signature supported. It is up to the programmer to ensure that the `userdata` argument contains a janet function the will be called with one argument, `ctx` which is an opaque pointer. This pointer can be further inspected with `ffi/read`.</pre><a href="https://janetdocs.com/ffi/trampoline">Community Examples</a></div><hr><div class="binding"><span id="ffi/write" class="binding-sym">ffi/write</span> <span class="binding-type">cfunction</span> <span class="binding-type"><a href="https://github.com/janet-lang/janet/blob/3a4d56a/src/core/ffi.c#L1384">source</a></span> <pre class="binding-text">(ffi/write ffi-type data &amp;opt buffer index)

Append a native type to a buffer such as it would appear in memory. This can be used to pass pointers to structs in the ffi, or send C/C++/native structs over the network or to files. Returns a modifed buffer or a new buffer if one is not supplied.</pre><a href="https://janetdocs.com/ffi/write">Community Examples</a></div>
        <div class="prevnext-bar">
          <span class="prev"><a href="ev.html"><span class="prevnext-text">Event Module</span></a></span>
          <span class="next"><a href="fiber.html"><span class="prevnext-text">Fiber Module</span></a></span>
        </div>
      </div>
    </div>

    
<footer>
  &copy; Calvin Rose &amp; contributors 2023
  <div class="gentag">Generated on June 19, 2023 at 12:21:57 (UTC) with Janet 1.29.1-3a4d56a</div>
  <div class="see-problem">See a problem? Source
    <a href="https://github.com/janet-lang/janet-lang.org">on GitHub</a></div>
</footer>



  </body>
</html>
