
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>netrepl</title>
    <meta name="description" content="Janet is a functional and imperative programming language. It runs on Windows, Linux, macOS, FreeBSD and *nix.">
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="../../css/docpage.css" type="text/css" media="screen" charset="utf-8">
    <link rel="shortcut icon" href="../assets/favicon.ico">

    <!-- Open Graph -->
    <meta property="og:description" content="Janet is a functional and imperative programming language. It runs on Windows, Linux, macOS, FreeBSD and *nix." />
    <meta property="og:title" content="netrepl" />
    <meta property="og:type" content="website" />
  </head>
  <body>

    <div id="toc-toggle" class="open">
      <div class="bar topbar"></div>
      <div class="bar"></div>
      <div class="bar botbar"></div>
    </div>
    <iframe class="search-bar" src="https://duckduckgo.com/search.html?site=janet-lang.org&prefill=Search janet-lang.org" frameborder="0"></iframe>
    <script charset="utf-8">
      function toggleToc() {
        var toggler = document.getElementById('toc-toggle');
        var wrapper = document.querySelector('.toc');
        wrapper.classList.toggle('toc-hidden');
        toggler.classList.toggle('open');
        if (window.localStorage) {
          window.localStorage.setItem('show-toc', toggler.classList.contains('open'));
        }
      }
      function addTocToggle() {
        var el = document.getElementById('toc-toggle');
        if (!window.localStorage || window.localStorage.getItem('show-toc') === 'true') {
          toggleToc()
        }
        el.addEventListener('click', toggleToc);
      }
      window.addEventListener('DOMContentLoaded', addTocToggle);
    </script>

    

    <div class="twocol">
      <div class="toc show-toc">
        <ul>
          <li><span><a href="../../index.html">Home</a></span></li><li class="caret"><span><a href="../../docs/index.html">Documentation</a></span><ul><li><span><a href="../../docs/syntax.html">Syntax and the Parser</a></span></li><li><span><a href="../../docs/specials.html">Special Forms</a></span></li><li><span><a href="../../docs/numbers.html">Numbers and Arithmetic</a></span></li><li><span><a href="../../docs/comparison.html">Comparison Operators</a></span></li><li><span><a href="../../docs/bindings.html">Bindings (def and var)</a></span></li><li><span><a href="../../docs/flow.html">Flow</a></span></li><li><span><a href="../../docs/functions.html">Functions</a></span></li><li><span><a href="../../docs/strings.html">Strings, Keywords, and Symbols</a></span></li><li><span><a href="../../docs/loop.html">Looping</a></span></li><li><span><a href="../../docs/macros.html">Macros</a></span></li><li class="caret"><span><a href="../../docs/data_structures/index.html">Data Structures</a></span><ul><li><span><a href="../../docs/data_structures/arrays.html">Arrays</a></span></li><li><span><a href="../../docs/data_structures/buffers.html">Buffers</a></span></li><li><span><a href="../../docs/data_structures/tables.html">Tables</a></span></li><li><span><a href="../../docs/data_structures/structs.html">Structs</a></span></li><li><span><a href="../../docs/data_structures/tuples.html">Tuples</a></span></li></ul></li><li><span><a href="../../docs/destructuring.html">Destructuring</a></span></li><li class="caret"><span><a href="../../docs/fibers/index.html">Fibers</a></span><ul><li><span><a href="../../docs/fibers/dynamic_bindings.html">Dynamic Bindings</a></span></li><li><span><a href="../../docs/fibers/error_handling.html">Errors</a></span></li></ul></li><li><span><a href="../../docs/modules.html">Modules</a></span></li><li><span><a href="../../docs/object_oriented.html">Object-Oriented Programming</a></span></li><li><span><a href="../../docs/peg.html">Parsing Expression Grammars</a></span></li><li><span><a href="../../docs/prototypes.html">Prototypes</a></span></li><li><span><a href="../../docs/abstract_machine.html">The Janet Abstract Machine</a></span></li><li><span><a href="../../docs/event_loop.html">The Event Loop</a></span></li><li><span><a href="../../docs/threads.html">Multithreading</a></span></li><li><span><a href="../../docs/networking.html">Networking</a></span></li><li class="caret"><span><a href="../../docs/process_management/index.html">Process Management</a></span><ul><li><span><a href="../../docs/process_management/execute.html">Executing</a></span></li><li><span><a href="../../docs/process_management/spawn.html">Spawning</a></span></li></ul></li><li><span><a href="../../docs/documentation.html">Documentation</a></span></li><li><span><a href="../../docs/linting.html">Linting</a></span></li><li><span><a href="../../docs/ffi.html">Foreign Function Interface</a></span></li></ul></li><li class="caret"><span><a href="../../api/index.html">Core API</a></span><ul><li><span><a href="../../api/array.html">array</a></span></li><li><span><a href="../../api/buffer.html">buffer</a></span></li><li><span><a href="../../api/bundle.html">bundle</a></span></li><li><span><a href="../../api/debug.html">debug</a></span></li><li><span><a href="../../api/ev.html">ev</a></span></li><li><span><a href="../../api/ffi.html">ffi</a></span></li><li><span><a href="../../api/fiber.html">fiber</a></span></li><li><span><a href="../../api/file.html">file</a></span></li><li><span><a href="../../api/filewatch.html">filewatch</a></span></li><li><span><a href="../../api/int.html">int</a></span></li><li><span><a href="../../api/janet.html">janet</a></span></li><li><span><a href="../../api/math.html">math</a></span></li><li><span><a href="../../api/module.html">module</a></span></li><li><span><a href="../../api/net.html">net</a></span></li><li><span><a href="../../api/os.html">os</a></span></li><li><span><a href="../../api/peg.html">peg</a></span></li><li><span><a href="../../api/parser.html">parser</a></span></li><li><span><a href="../../api/string.html">string</a></span></li><li><span><a href="../../api/table.html">table</a></span></li><li><span><a href="../../api/misc.html">misc</a></span></li><li><span><a href="../../api/tuple.html">tuple</a></span></li></ul></li><li class="caret"><span><a href="../../capi/index.html">C API</a></span><ul><li><span><a href="../../capi/wrapping.html">Wrapping Types</a></span></li><li><span><a href="../../capi/embedding.html">Embedding</a></span></li><li><span><a href="../../capi/configuration.html">Configuration</a></span></li><li><span><a href="../../capi/array.html">Array C API</a></span></li><li><span><a href="../../capi/buffer.html">Buffer C API</a></span></li><li><span><a href="../../capi/table.html">Table C API</a></span></li><li><span><a href="../../capi/fiber.html">Fiber C API</a></span></li><li><span><a href="../../capi/memory-model.html">Memory Model</a></span></li><li><span><a href="../../capi/writing-c-functions.html">Writing C Functions</a></span></li></ul></li><li class="caret"><span><a href="../../jpm/index.html">JPM</a></span><ul><li><span><a href="../../jpm/building-projects.html">Building Projects</a></span></li><li><span><a href="../../jpm/project.janet.html">Project.janet</a></span></li><li><span><a href="../../jpm/local-install.html">Local Install</a></span></li><li><span><a href="../../jpm/versioning.html">Versioning and Bundling</a></span></li><li class="caret"><span><a href="../../jpm/api/index.html">API</a></span><ul><li><span><a href="../../jpm/api/rules.html">rules</a></span></li><li><span><a href="../../jpm/api/cc.html">cc</a></span></li><li><span><a href="../../jpm/api/cgen.html">cgen</a></span></li><li><span><a href="../../jpm/api/cli.html">cli</a></span></li><li><span><a href="../../jpm/api/commands.html">commands</a></span></li><li><span><a href="../../jpm/api/config.html">config</a></span></li><li><span><a href="../../jpm/api/make-config.html">make-config</a></span></li><li><span><a href="../../jpm/api/dagbuild.html">dagbuild</a></span></li><li><span><a href="../../jpm/api/pm.html">pm</a></span></li><li><span><a href="../../jpm/api/scaffold.html">scaffold</a></span></li><li><span><a href="../../jpm/api/shutil.html">shutil</a></span></li></ul></li></ul></li><li class="caret"><span><a href="../index.html">Spork</a></span><ul><li class="caret"><span><a href="index.html">API</a></span><ul><li><span><a href="argparse.html">argparse</a></span></li><li><span><a href="base64.html">base64</a></span></li><li><span><a href="build-rules.html">build-rules</a></span></li><li><span><a href="cc.html">cc</a></span></li><li><span><a href="channel.html">channel</a></span></li><li><span><a href="cjanet.html">cjanet</a></span></li><li><span><a href="cmath.html">cmath</a></span></li><li><span><a href="crc.html">crc</a></span></li><li><span><a href="cron.html">cron</a></span></li><li><span><a href="data.html">data</a></span></li><li><span><a href="ev-utils.html">ev-utils</a></span></li><li><span><a href="fmt.html">fmt</a></span></li><li><span><a href="generators.html">generators</a></span></li><li><span><a href="getline.html">getline</a></span></li><li><span><a href="htmlgen.html">htmlgen</a></span></li><li><span><a href="http.html">http</a></span></li><li><span><a href="httpf.html">httpf</a></span></li><li><span><a href="infix.html">infix</a></span></li><li><span><a href="json.html">json</a></span></li><li><span><a href="math.html">math</a></span></li><li><span><a href="mdz.html">mdz</a></span></li><li><span><a href="misc.html">misc</a></span></li><li><span><a href="msg.html">msg</a></span></li><li><span class="selected"><a href="netrepl.html">netrepl</a></span></li><li><span><a href="path.html">path</a></span></li><li><span><a href="pgp.html">pgp</a></span></li><li><span><a href="randgen.html">randgen</a></span></li><li><span><a href="rawterm.html">rawterm</a></span></li><li><span><a href="regex.html">regex</a></span></li><li><span><a href="rpc.html">rpc</a></span></li><li><span><a href="schema.html">schema</a></span></li><li><span><a href="services.html">services</a></span></li><li><span><a href="sh.html">sh</a></span></li><li><span><a href="stream.html">stream</a></span></li><li><span><a href="tarray.html">tarray</a></span></li><li><span><a href="tasker.html">tasker</a></span></li><li><span><a href="temple.html">temple</a></span></li><li><span><a href="test.html">test</a></span></li><li><span><a href="utf8.html">utf8</a></span></li><li><span><a href="zip.html">zip</a></span></li></ul></li></ul></li>
        </ul>
      </div>
      <div class="content-wrapper main-content">
        <h4 class="subtitle">Janet 1.39.1-e9c6678 Documentation<br>(Other Versions:
          
          <a href="../../../1.38.0/spork/api/netrepl.html">1.38.0</a>
          
          <a href="../../../1.37.1/spork/api/netrepl.html">1.37.1</a>
          
          <a href="../../../1.36.0/spork/api/netrepl.html">1.36.0</a>
          
          <a href="../../../1.35.0/spork/api/netrepl.html">1.35.0</a>
          
          <a href="../../../1.34.0/spork/api/netrepl.html">1.34.0</a>
          
          <a href="../../../1.31.0/spork/api/netrepl.html">1.31.0</a>
          
          <a href="../../../1.29.1/spork/api/netrepl.html">1.29.1</a>
          
          <a href="../../../1.28.0/spork/api/netrepl.html">1.28.0</a>
          
          <a href="../../../1.27.0/spork/api/netrepl.html">1.27.0</a>
          
          <a href="../../../1.26.0/spork/api/netrepl.html">1.26.0</a>
          
          <a href="../../../1.25.1/spork/api/netrepl.html">1.25.1</a>
          
          <a href="../../../1.24.0/spork/api/netrepl.html">1.24.0</a>
          
          <a href="../../../1.23.0/spork/api/netrepl.html">1.23.0</a>
          
          <a href="../../../1.22.0/spork/api/netrepl.html">1.22.0</a>
          
          <a href="../../../1.21.0/spork/api/netrepl.html">1.21.0</a>
          
          <a href="../../../1.20.0/spork/api/netrepl.html">1.20.0</a>
          
          <a href="../../../1.19.0/spork/api/netrepl.html">1.19.0</a>
          
          <a href="../../../1.18.1/spork/api/netrepl.html">1.18.1</a>
          
          <a href="../../../1.17.1/spork/api/netrepl.html">1.17.1</a>
          
          <a href="../../../1.16.1/spork/api/netrepl.html">1.16.1</a>
          
          <a href="../../../1.15.0/spork/api/netrepl.html">1.15.0</a>
          
          <a href="../../../1.13.1/spork/api/netrepl.html">1.13.1</a>
          
          <a href="../../../1.12.2/spork/api/netrepl.html">1.12.2</a>
          
          <a href="../../../1.11.1/spork/api/netrepl.html">1.11.1</a>
          
          <a href="../../../1.10.1/spork/api/netrepl.html">1.10.1</a>
          
          <a href="../../../1.9.1/spork/api/netrepl.html">1.9.1</a>
          
          <a href="../../../1.8.1/spork/api/netrepl.html">1.8.1</a>
          
          <a href="../../../1.7.0/spork/api/netrepl.html">1.7.0</a>
          
          <a href="../../../1.6.0/spork/api/netrepl.html">1.6.0</a>
          
          <a href="../../../1.5.1/spork/api/netrepl.html">1.5.1</a>
          
          <a href="../../../1.5.0/spork/api/netrepl.html">1.5.0</a>
          
          <a href="../../../1.4.0/spork/api/netrepl.html">1.4.0</a>
          
          <a href="../../../1.3.1/spork/api/netrepl.html">1.3.1</a>
          )</h4>
        <h1 class="subtitle">netrepl</h1>
        <div class="prevnext-bar">
          <span class="prev"><a href="msg.html"><span class="prevnext-text">msg</span></a></span>

          <span class="next"><a href="path.html"><span class="prevnext-text">path</span></a></span>
        </div>
        

<p>A simple async networked repl (both client and server) with a remote debugger
and the ability to repl into existing environments.
</p>

<h2 id="Specifying-the-Environment">Specifying the Environment
</h2>
<p>Provide various ways to produce the environment to repl into.
<ol>
  <li>an environment factory function, called for each connection.</li>
  <li>an env (table value) - this means every connection will share the same environment</li>
  <li>default env, made via make-env with nice printing for each new connection.</li>
</ol>
</p>
<h2 id="NETREPL-Protocol">NETREPL Protocol
</h2>
<p>Clients don't need to support steps 4. and 5. if they never send messages prefixed with 0xFF or 0xFE bytes. These bytes should not occur in normal Janet source code and are not even valid utf8.
</p>
<p>Any message received by the client that begins with 0xFF should result in printing the message to a console, but not otherwise interrupt the flow of the protocol. 
  This easily allows for partial results. A server should not send messages leading with 0xFF to the client unless the client is created with the :auto-flush connection setting.
</p>
<p>Any message received by the client that begins with 0xFE will discard this first byte and continue processing as usual.
</p>
<ol>
  <li>server &lt;- {connection settings, including client name<code class="mendoza-code">}</code> &lt;- client
      <ol><li>If msg starts with 0xFF, parse message as (-&gt; msg (slice 1) parse) and extract the :name key as the name. Other connection settings can be stored here.</li>
          <li>If msg does not start with 0xFF, the message is treated as the client name. Other options are considered nil.</li></ol></li>
  <li>server -&gt; {repl prompt (no newline)<code class="mendoza-code">}</code> -&gt; client</li>
  <li>server &lt;- {one chunk of input (msg)<code class="mendoza-code">}</code> &lt;- client</li>
  <li>If (= (msg 0) 0xFF)
      <ol><li>(def result (-&gt; msg (slice 1) parse eval protect))</li>
          <li>server -&gt; result -&gt; client</li>
          <li>goto 3.</li></ol></li>
  <li>If (= (msg 0) 0xFE)</li>
  <ol><li>Return msg as either:
      <ol><li>a keyword if the msg contains a command (e.g. :cancel)</li>
          <li>an array if the msg contains a command and arguments (e.g. <code class="mendoza-code">@[:source "path/to/source"]</code></li></ol>
      <li>goto 6b.</li></li></ol>
  <li>Otherwise
      <ol><li>Send chunk to repl input stream</li>
          <li>Unless auto-flush is enabled, server -&gt; {(dyn :out) and (dyn :err) (empty at first)<code class="mendoza-code">}</code> -&gt; client</li>
          <li>goto 2.</li></ol></li>
</ol><h2 id="Examples-4">Examples
</h2>
<p>Launch a networked REPL server on one machine and connect to it from another machine or process.
</p>
<h3 id="Server-2">Server
</h3>
<pre class="mendoza-codeblock"><code data-language="janet">(<span class="mdzsyn-coresym">import</span> <span class="mdzsyn-symbol">spork/netrepl</span>)

(<span class="mdzsyn-coresym">def</span> <span class="mdzsyn-symbol">some-def</span> <span class="mdzsyn-number">10</span>)

<span class="mdzsyn-comment"># Serve a repl into the current environment (@code`some-def` will be visible).</span>
(<span class="mdzsyn-symbol">netrepl/server</span> <span class="mdzsyn-string">"127.0.0.1"</span> <span class="mdzsyn-string">"9000"</span> (<span class="mdzsyn-coresym">fiber/getenv</span> (<span class="mdzsyn-coresym">fiber/current</span>)))</code></pre><h3 id="Client-2">Client
</h3>
<pre class="mendoza-codeblock"><code data-language="janet">(<span class="mdzsyn-coresym">import</span> <span class="mdzsyn-symbol">spork/netrepl</span>)

<span class="mdzsyn-comment"># Starts a nice terminal repl.</span>
(<span class="mdzsyn-symbol">netrepl/client</span> <span class="mdzsyn-string">"127.0.0.1"</span> <span class="mdzsyn-string">"9000"</span> <span class="mdzsyn-string">"bob"</span>)</code></pre><h2 id="Reference-22">Reference
</h2>
<p><a href="#netrepl/client">netrepl/client</a> <a href="#netrepl/default-host">netrepl/default-host</a> <a href="#netrepl/default-port">netrepl/default-port</a> <a href="#netrepl/server">netrepl/server</a> <a href="#netrepl/server-single">netrepl/server-single</a> </p><hr><div class="binding"><span id="netrepl/client" class="binding-sym">netrepl/client</span> <span class="binding-type">function</span> <span class="binding-type"><a href="https://github.com/janet-lang/spork/blob/7fd743ac09e857fe0ebd333bd7a56cd0df3876c3//spork/netrepl.janet#L334">source</a></span> <pre class="binding-text">(client &amp;opt host port name)

Connect to a repl server. The default host is "127.0.0.1" and the default port is "9365".</pre></div><hr><div class="binding"><span id="netrepl/default-host" class="binding-sym">netrepl/default-host</span> <span class="binding-type">string</span> <span class="binding-type"><a href="https://github.com/janet-lang/spork/blob/7fd743ac09e857fe0ebd333bd7a56cd0df3876c3//spork/netrepl.janet#L12">source</a></span> <pre class="binding-text">Default host to run server on and connect to.</pre></div><hr><div class="binding"><span id="netrepl/default-port" class="binding-sym">netrepl/default-port</span> <span class="binding-type">string</span> <span class="binding-type"><a href="https://github.com/janet-lang/spork/blob/7fd743ac09e857fe0ebd333bd7a56cd0df3876c3//spork/netrepl.janet#L16">source</a></span> <pre class="binding-text">Default port to run the net repl.</pre></div><hr><div class="binding"><span id="netrepl/server" class="binding-sym">netrepl/server</span> <span class="binding-type">function</span> <span class="binding-type"><a href="https://github.com/janet-lang/spork/blob/7fd743ac09e857fe0ebd333bd7a56cd0df3876c3//spork/netrepl.janet#L114">source</a></span> <pre class="binding-text">(server &amp;opt host port env cleanup welcome-msg)

Start a repl server. The default host is "127.0.0.1" and the default port is "9365". Calling this will start a TCP server that exposes a repl into the given env. If no env is provided, a new env will be created per connection. If env is a function, that function will be invoked with the name and stream on each connection to generate an environment. `cleanup` is an optional function that will be called for each stream after closing if provided. `welcome-msg` is an optional string or function (welcome-msg client-name) to generate a message to print for the client on connection.</pre></div><hr><div class="binding"><span id="netrepl/server-single" class="binding-sym">netrepl/server-single</span> <span class="binding-type">function</span> <span class="binding-type"><a href="https://github.com/janet-lang/spork/blob/7fd743ac09e857fe0ebd333bd7a56cd0df3876c3//spork/netrepl.janet#L267">source</a></span> <pre class="binding-text">(server-single &amp;opt host port env cleanup welcome-msg)

Short-hand for serving up a a repl that has a single environment table in it. `env` must be a proper env table, not a function as is possible in netrepl/server.</pre></div>
        <div class="prevnext-bar">
          <span class="prev"><a href="msg.html"><span class="prevnext-text">msg</span></a></span>
          <span class="next"><a href="path.html"><span class="prevnext-text">path</span></a></span>
        </div>
      </div>
    </div>

    
<footer>
  &copy; Calvin Rose &amp; contributors 2025
  <div class="gentag">Generated on August 30, 2025 at 17:18:20 (UTC) with Janet 1.39.1-e9c6678</div>
  <div class="see-problem">See a problem? Source
    <a href="https://github.com/janet-lang/janet-lang.org">on GitHub</a></div>
</footer>



  </body>
</html>
